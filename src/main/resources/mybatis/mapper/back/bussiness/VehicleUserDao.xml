<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.june.dao.back.bussiness.vehicle.VehicleUserDao">
	<sql id="selectData">
		SELECT
			vt.VEHICLE_ID 	AS vehicleId,
			v.VEHICLE_NAME 	AS vehicleName,
			vt.USER_ID 		AS userId,
			u.USER_NAME 	AS userName,
			vt.ADD_USER_ID 	AS addUserId,
			vt.ADD_TIME 	AS addTime
		FROM USER_VEHICLE vt
		LEFT JOIN VEHICLE_TYPE v ON v.VEHICLE_ID = vt.VEHICLE_ID
		LEFT JOIN SYS_USER u 	 ON u.USER_ID 	 = vt.USER_ID
		WHERE 1=1
		<if test="userId != null and userId != ''">
			AND vt.USER_ID 		= #{userId}
		</if>
		<if test="vehicleId != null and vehicleId != ''">
			AND vt.VEHICLE_ID 	= #{vehicleId}
		</if>
		ORDER BY vt.ADD_TIME
	</sql>

	<!-- 查询车型列表 -->
	<select id="getPageList" resultType="com.june.dto.back.bussiness.vehicle.VehicleUser"
		parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		<include refid="pagetop" />
		<include refid="selectData" />
		<include refid="pageend" />
	</select>
	<sql id="pagetop">
		<![CDATA[SELECT * FROM (SELECT ROWNUM AS PNUM, TNUM.* FROM ( ]]>
	</sql>
	<sql id="pageend">
		<![CDATA[) TNUM WHERE ROWNUM <= #{startadd} + #{pageSize}) TPAGE WHERE TPAGE.PNUM > #{start}]]>
	</sql>
	<!-- 查询总条数 -->
	<select id="getTotal" resultType="int">
		SELECT COUNT(1) FROM ( <include refid="selectData" /> ) T
	</select>

	<!-- 查询所有车型列表 -->
	<select id="getList" resultType="com.june.dto.back.bussiness.vehicle.VehicleUser"
		parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		<include refid="selectData" />
	</select>

	<!-- 根据车型id 获取一条记录 -->
	<select id="get" parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser"
		resultType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		SELECT
			vt.VEHICLE_ID 	AS vehicleId,
			v.VEHICLE_NAME 	AS vehicleName,
			vt.USER_ID 		AS userId,
			u.USER_NAME 	AS userName,
			vt.ADD_USER_ID 	AS addUserId,
			vt.ADD_TIME 	AS addTime
		FROM USER_VEHICLE vt
		LEFT JOIN VEHICLE_TYPE v 	ON v.VEHICLE_ID = vt.VEHICLE_ID
		LEFT JOIN SYS_USER u 		ON u.USER_ID 	= vt.USER_ID
		WHERE
			vt.VEHICLE_ID = #{vehicleId}
		AND vt.USER_ID = #{userId}
	</select>

	<!-- 添加信息 -->
	<insert id="add" parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		INSERT INTO 
			USER_VEHICLE ( VEHICLE_ID, USRE_ID, ADD_USER_ID, ADD_TIME )
		VALUES ( #{vehicleId}, #{userId}, #{addUserId}, SYSDATE )
	</insert>
	<!-- 批量添加信息 -->
	<insert id="addList" parameterType="java.util.List">
		INSERT INTO USER_VEHICLE ( VEHICLE_ID, USRE_ID, ADD_USER_ID, ADD_TIME )
		<foreach collection="list" item="item" index="index"
			separator="UNION ALL">
			SELECT #{item.vehicleId}, #{item.userId}, #{item.addUserId}, SYSDATE FROM DUAL
		</foreach>
	</insert>

	<!-- 编辑车型信息 -->
	<update id="update" parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		UPDATE 
			USER_VEHICLE
		SET
			VEHICLE_ID = #{vehicleId},
			USER_ID = #{userId}
		WHERE 
			VEHICLE_ID = #{vehicleId}
		AND USER_ID = #{userId}
	</update>

	<!-- 删除车型 -->
	<delete id="delete" parameterType="com.june.dto.back.bussiness.vehicle.VehicleUser">
		DELETE FROM USER_VEHICLE WHERE 1=1
		<if test="vehicleId != null and vehicleId != ''">
			AND v.VEHICLE_ID = #{vehicleId}
		</if>
		<if test="userId != null and userId != ''">
			AND v.USER_ID = #{userId}
		</if>
	</delete>
</mapper>