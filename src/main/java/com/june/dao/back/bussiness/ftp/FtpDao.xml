<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.june.dao.back.bussiness.ftp.FtpDao">
	<!-- 查询列表SQL -->
	<sql id="selectData">
		SELECT v.FTP_ID       	AS ftpId,
		       v.FTP_IP     	AS ftpIP,
		       v.FTP_USER    	AS ftpUser,
		       v.FTP_PASSWORD 	AS ftpPassword,
		       v.FTP_PATH   	AS ftpPath,
		       v.ADD_USER_ID    AS addUserId,
		       v.ADD_TIME       AS addTime,
		       v.UPDATE_USER_ID AS updateUserId,
		       v.UPDATE_TIME    AS updateTime,
		       v.VERSION        AS version
		  FROM SYS_FTP v
		 WHERE 1 = 1
		<if test="ftpIP != null and ftpIP != ''">
			AND v.FTP_IP LIKE CONCAT(CONCAT('%', #{ftpIP}), '%')
		</if>
		<if test="ftpPath != null and ftpPath != ''">
			AND v.FTP_PATH LIKE CONCAT(CONCAT('%', #{ftpPath}), '%')
		</if>
	</sql>
	<!-- 查询FTP设置列表 -->
	<select id="getPageList" resultType="com.june.dto.back.bussiness.ftp.FtpDto"
		parameterType="com.june.dto.back.bussiness.ftp.FtpDto">
		<include refid="pagetop" />
		<include refid="selectData" />
			ORDER BY v.ADD_TIME
		<include refid="pageend" />
	</select>
	<sql id="pagetop">
		<![CDATA[SELECT * FROM (SELECT ROWNUM AS PNUM, TNUM.* FROM ( ]]>
	</sql>
	<sql id="pageend">
		<![CDATA[) TNUM WHERE ROWNUM <= #{startadd} + #{pageSize}) TPAGE WHERE TPAGE.PNUM > #{start}]]>
	</sql>
	<sql id="pagelimit">
		limit #{start}, #{pageSize}
	</sql>

	<!-- 查询总条数 -->
	<select id="getTotal" resultType="int">
		SELECT COUNT(1) FROM ( <include refid="selectData" /> ) T
	</select>

	<!-- 查询所有FTP设置列表 -->
	<select id="getList" resultType="com.june.dto.back.bussiness.ftp.FtpDto" 
		parameterType="com.june.dto.back.bussiness.ftp.FtpDto">
		<include refid="selectData" />
	</select>
	
	<!-- 根据FTP设置id 获取一条记录 -->
	<select id="get" parameterType="com.june.dto.back.bussiness.ftp.FtpDto" 
		resultType="com.june.dto.back.bussiness.ftp.FtpDto">
		SELECT v.FTP_ID       	AS ftpId,
		       v.FTP_IP     	AS ftpIP,
		       v.FTP_USER    	AS ftpUser,
		       v.FTP_PASSWORD 	AS ftpPassword,
		       v.FTP_PATH   	AS ftpPath,
		       v.ADD_USER_ID    AS addUserId,
		       v.ADD_TIME       AS addTime,
		       v.UPDATE_USER_ID AS updateUserId,
		       v.UPDATE_TIME    AS updateTime,
		       v.VERSION        AS version
		  FROM SYS_FTP v 
		WHERE v.FTP_ID = #{ftpId}
	</select>

	<!-- 添加FTP设置信息 -->
	<insert id="add" parameterType="com.june.dto.back.bussiness.ftp.FtpDto">
		<selectKey keyProperty="ftpId" resultType="java.lang.String" order="BEFORE">
			SELECT SEQ_SYS_FTP.NEXTVAL AS FTP_ID FROM DUAL 
		</selectKey>
		INSERT INTO SYS_FTP
		  (FTP_ID,
		   FTP_IP,
		   FTP_USER,
		   FTP_PASSWORD,
		   FTP_PATH,
		   ADD_USER_ID,
		   ADD_TIME,
		   UPDATE_USER_ID,
		   UPDATE_TIME,
		   VERSION)
		VALUES
		  (#{ftpId},
		   #{ftpIP},
		   #{ftpUser},
		   #{ftpPassword},
		   #{ftpPath},
		   #{addUserId},
		   SYSDATE,
		   #{addUserId},
		   SYSDATE,
		   0)
	</insert>

	<!-- 编辑FTP设置信息 -->
	<update id="update" parameterType="com.june.dto.back.bussiness.ftp.FtpDto">
		UPDATE SYS_FTP
		   SET FTP_IP     	= #{ftpIP},
		       FTP_USER    	= #{ftpUser},
		       FTP_PASSWORD	= #{ftpPassword},
		       FTP_PATH   	= #{ftpPath},
		       UPDATE_USER_ID = #{sys_user},
		       UPDATE_TIME    = SYSDATE,
		       VERSION        = VERSION + 1
		 WHERE FTP_ID = #{ftpId}
	</update>

	<!-- 删除FTP设置 -->
	<delete id="delete" parameterType="com.june.dto.back.bussiness.ftp.FtpDto">
	  DELETE FROM SYS_FTP WHERE FTP_ID = #{ftpId}
	</delete>
</mapper>